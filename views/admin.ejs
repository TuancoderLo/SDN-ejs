<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <style>
      .section {
        display: none;
      }
      .section.active {
        display: block;
      }

      /* Admin table polish */
      .table tr:hover td {
        background-color: hsl(var(--b2) / 0.35);
        transition: background-color 0.2s ease;
      }
      .badge-soft {
        background: hsl(var(--p) / 0.12);
        color: hsl(var(--p));
      }

      /* Performance optimized transitions */
      * {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .admin-tab {
        will-change: opacity, transform;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
      }

      .tab.active {
        background: linear-gradient(135deg, hsl(var(--p)), hsl(var(--s)));
        color: white !important;
        transform: scale(1.05);
        box-shadow: 0 4px 15px hsl(var(--p) / 0.3);
      }

      .tab.active span {
        color: white !important;
      }

      .tab.active i {
        color: white !important;
      }

      .card {
        backdrop-filter: blur(10px);
        border: 1px solid hsl(var(--b3) / 0.5);
      }

      .btn {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
      }

      .btn:hover {
        transform: translateY(-1px);
      }

      .btn:active {
        transform: translateY(0);
      }

      /* Gradient text effect */
      .gradient-text {
        background: linear-gradient(
          135deg,
          hsl(var(--p)),
          hsl(var(--s)),
          hsl(var(--a))
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: hsl(var(--b2));
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, hsl(var(--p)), hsl(var(--s)));
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(
          135deg,
          hsl(var(--p) / 0.8),
          hsl(var(--s) / 0.8)
        );
      }

      /* Enhanced form inputs */
      .input:focus,
      .select:focus {
        box-shadow: 0 0 0 3px hsl(var(--p) / 0.2);
        border-color: hsl(var(--p));
      }

      /* Stats enhancement with performance optimization */
      .stat {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
          box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
      }

      .stat:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px hsl(var(--b3) / 0.25);
      }

      /* Optimize table animations */
      .table tr {
        transition: background-color 0.15s ease;
      }

      .table tr:hover td {
        background-color: hsl(var(--b2) / 0.35);
      }

      /* Enhanced Modal Fixes */
      .modal {
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
      }

      .modal:target,
      .modal[open] {
        opacity: 1;
        visibility: visible;
      }

      .modal-box {
        transform: translateY(50px);
        transition: transform 0.3s ease;
        max-height: 90vh;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: hsl(var(--p)) transparent;
      }

      .modal:target .modal-box,
      .modal[open] .modal-box {
        transform: translateY(0);
      }

      /* Prevent body scroll when modal is open */
      body.modal-open {
        overflow: hidden;
        padding-right: 0;
      }

      /* Smooth tab transitions */
      .admin-tab {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .admin-tab:not(.hidden) {
        opacity: 1;
        transform: translateY(0);
      }

      /* Tab button enhancements */
      .tab {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .tab::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .tab:hover::before {
        left: 100%;
      }
    </style>
  </head>
  <body class="bg-base-100">
    <%- include('partials/navbar') %>

    <main
      class="min-h-screen bg-gradient-to-b from-base-100 via-base-200/40 to-base-100"
    >
      <!-- Admin Section -->
      <section id="admin" class="section active">
        <div class="container mx-auto px-4 py-12">
          <!-- Admin Header -->
          <div
            class="hero bg-gradient-to-br from-primary/10 via-secondary/10 to-accent/10 rounded-3xl mb-8 shadow-xl"
          >
            <div class="hero-content text-center py-12">
              <div class="max-w-3xl">
                <div class="mb-8">
                  <div
                    class="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-accent to-primary flex items-center justify-center shadow-lg"
                  >
                    <i class="fas fa-crown text-3xl text-white"></i>
                  </div>
                </div>
                <h1 class="text-5xl font-bold mb-4">
                  <span
                    class="bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent"
                    >Admin</span
                  >
                  <span class="text-base-content">Panel</span>
                </h1>
                <p class="text-xl text-base-content/70 mb-6">
                  Manage your perfume collection, brands, and members with ease
                </p>
                <div class="flex justify-center gap-4">
                  <div class="badge badge-primary badge-lg gap-2">
                    <i class="fas fa-users"></i>
                    <span>Members</span>
                  </div>
                  <div class="badge badge-secondary badge-lg gap-2">
                    <i class="fas fa-tags"></i>
                    <span>Brands</span>
                  </div>
                  <div class="badge badge-accent badge-lg gap-2">
                    <i class="fas fa-spray-can"></i>
                    <span>Perfumes</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Admin Tabs -->
          <div
            class="flex flex-col lg:flex-row justify-center items-center gap-4 mb-8"
          >
            <div class="tabs tabs-boxed bg-base-200/50 p-1 rounded-2xl">
              <button
                class="tab tab-lg active hover:bg-base-100 transition-all duration-300"
                onclick="showAdminTab('members')"
              >
                <i class="fas fa-users mr-2 text-primary"></i>
                <span class="font-semibold">Members</span>
              </button>
              <button
                class="tab tab-lg hover:bg-base-100 transition-all duration-300"
                onclick="showAdminTab('brands')"
              >
                <i class="fas fa-tags mr-2 text-secondary"></i>
                <span class="font-semibold">Brands</span>
              </button>
              <button
                class="tab tab-lg hover:bg-base-100 transition-all duration-300"
                onclick="showAdminTab('perfumes')"
              >
                <i class="fas fa-spray-can mr-2 text-accent"></i>
                <span class="font-semibold">Perfumes</span>
              </button>
              <button
                class="tab tab-lg hover:bg-base-100 transition-all duration-300"
                onclick="showAdminTab('profile')"
              >
                <i class="fas fa-user-cog mr-2 text-primary"></i>
                <span class="font-semibold">Profile</span>
              </button>
            </div>
            <button
              class="btn btn-outline btn-primary hover:btn-primary hover:text-white transition-all duration-300"
              onclick="loadAllAdminData()"
            >
              <i class="fas fa-sync-alt mr-2"></i>
              Load All Data
            </button>
          </div>

          <!-- Members Tab -->
          <div id="adminMembers" class="admin-tab">
            <div
              class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300"
            >
              <div class="card-body">
                <div class="flex items-center justify-between mb-8">
                  <div class="flex items-center gap-4">
                    <div
                      class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-primary/80 flex items-center justify-center"
                    >
                      <i class="fas fa-users text-white text-lg"></i>
                    </div>
                    <div>
                      <h2 class="card-title text-2xl">All Members</h2>
                      <p class="text-base-content/70">
                        Manage user accounts and permissions
                      </p>
                    </div>
                  </div>
                  <button
                    class="btn btn-primary btn-lg hover:scale-105 transition-transform duration-300"
                    onclick="loadMembers()"
                  >
                    <i class="fas fa-sync-alt mr-2"></i>
                    Refresh
                  </button>
                </div>
                <div id="membersTable" class="rounded-xl overflow-hidden">
                  <!-- Members table will be loaded here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Brands Tab -->
          <div id="adminBrands" class="admin-tab hidden">
            <div
              class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300"
            >
              <div class="card-body">
                <div class="flex items-center justify-between mb-8">
                  <div class="flex items-center gap-4">
                    <div
                      class="w-12 h-12 rounded-xl bg-gradient-to-br from-secondary to-secondary/80 flex items-center justify-center"
                    >
                      <i class="fas fa-tags text-white text-lg"></i>
                    </div>
                    <div>
                      <h2 class="card-title text-2xl">Brand Management</h2>
                      <p class="text-base-content/70">
                        Add, edit, and organize perfume brands
                      </p>
                    </div>
                  </div>
                  <div class="flex gap-3">
                    <button
                      class="btn btn-primary btn-lg hover:scale-105 transition-transform duration-300"
                      onclick="showBrandForm()"
                    >
                      <i class="fas fa-plus mr-2"></i>
                      Add Brand
                    </button>
                    <button
                      class="btn btn-secondary btn-lg hover:scale-105 transition-transform duration-300"
                      onclick="loadAdminBrands()"
                    >
                      <i class="fas fa-sync-alt mr-2"></i>
                      Refresh
                    </button>
                  </div>
                </div>
                <div id="brandsTable" class="rounded-xl overflow-hidden">
                  <!-- Brands table will be loaded here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Perfumes Tab -->
          <div id="adminPerfumes" class="admin-tab hidden">
            <div
              class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300"
            >
              <div class="card-body">
                <div class="flex items-center justify-between mb-8">
                  <div class="flex items-center gap-4">
                    <div
                      class="w-12 h-12 rounded-xl bg-gradient-to-br from-accent to-accent/80 flex items-center justify-center"
                    >
                      <i class="fas fa-spray-can text-white text-lg"></i>
                    </div>
                    <div>
                      <h2 class="card-title text-2xl">Perfume Management</h2>
                      <p class="text-base-content/70">
                        Manage your perfume collection and inventory
                      </p>
                    </div>
                  </div>
                  <div class="flex gap-3">
                    <button
                      class="btn btn-primary btn-lg hover:scale-105 transition-transform duration-300"
                      onclick="showPerfumeForm()"
                    >
                      <i class="fas fa-plus mr-2"></i>
                      Add Perfume
                    </button>
                    <button
                      class="btn btn-secondary btn-lg hover:scale-105 transition-transform duration-300"
                      onclick="loadAdminPerfumes()"
                    >
                      <i class="fas fa-sync-alt mr-2"></i>
                      Refresh
                    </button>
                  </div>
                </div>
                <div id="perfumesTable" class="rounded-xl overflow-hidden">
                  <!-- Perfumes table will be loaded here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Profile Tab -->
          <div id="adminProfile" class="admin-tab hidden">
            <!-- Profile Header -->
            <div
              class="hero bg-gradient-to-r from-primary/10 via-secondary/10 to-accent/10 rounded-2xl mb-8"
            >
              <div class="hero-content text-center">
                <div class="max-w-2xl">
                  <div class="avatar mb-6">
                    <div
                      class="w-24 h-24 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center"
                    >
                      <i class="fas fa-user-cog text-3xl text-white"></i>
                    </div>
                  </div>
                  <h1 class="text-3xl font-bold mb-2">
                    <span class="text-primary">Profile</span> Management
                  </h1>
                  <p class="text-base-content/70">
                    Manage your personal information and account settings
                  </p>
                </div>
              </div>
            </div>

            <!-- Main Profile Grid -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
              <!-- Personal Information Card -->
              <div
                class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300"
              >
                <div class="card-body flex flex-col h-full">
                  <div class="flex items-center gap-3 mb-6">
                    <div
                      class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-primary/80 flex items-center justify-center"
                    >
                      <i class="fas fa-user-edit text-white text-lg"></i>
                    </div>
                    <h2 class="card-title text-xl">Personal Information</h2>
                  </div>

                  <form id="profileForm" class="flex-1 flex flex-col">
                    <div class="space-y-5 flex-1">
                      <div class="form-control">
                        <label class="label">
                          <span
                            class="label-text font-semibold flex items-center gap-2"
                          >
                            <i class="fas fa-user text-primary"></i>
                            Full Name
                          </span>
                        </label>
                        <input
                          type="text"
                          id="profileName"
                          placeholder="Enter your full name"
                          class="input input-bordered input-primary focus:input-primary"
                          required
                        />
                      </div>

                      <div class="form-control">
                        <label class="label">
                          <span
                            class="label-text font-semibold flex items-center gap-2"
                          >
                            <i class="fas fa-calendar text-primary"></i>
                            Year of Birth
                          </span>
                        </label>
                        <input
                          type="number"
                          id="profileYOB"
                          min="1900"
                          max="2024"
                          placeholder="YYYY"
                          class="input input-bordered input-primary focus:input-primary"
                          required
                        />
                      </div>

                      <div class="form-control">
                        <label class="label">
                          <span
                            class="label-text font-semibold flex items-center gap-2"
                          >
                            <i class="fas fa-venus-mars text-primary"></i>
                            Gender
                          </span>
                        </label>
                        <select
                          id="profileGender"
                          class="select select-bordered select-primary focus:select-primary"
                          required
                        >
                          <option value="true">Male</option>
                          <option value="false">Female</option>
                        </select>
                      </div>
                    </div>

                    <div class="card-actions justify-center mt-auto pt-8">
                      <button
                        type="submit"
                        class="btn btn-primary btn-lg w-full"
                      >
                        <i class="fas fa-save mr-2"></i>
                        Update Profile
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Change Password Card -->
              <div
                class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300"
              >
                <div class="card-body flex flex-col h-full">
                  <div class="flex items-center gap-3 mb-6">
                    <div
                      class="w-12 h-12 rounded-xl bg-gradient-to-br from-secondary to-secondary/80 flex items-center justify-center"
                    >
                      <i class="fas fa-lock text-white text-lg"></i>
                    </div>
                    <h2 class="card-title text-xl">Change Password</h2>
                  </div>

                  <form id="passwordForm" class="flex-1 flex flex-col">
                    <div class="space-y-5 flex-1">
                      <div class="form-control">
                        <label class="label">
                          <span
                            class="label-text font-semibold flex items-center gap-2"
                          >
                            <i class="fas fa-key text-secondary"></i>
                            Current Password
                          </span>
                        </label>
                        <input
                          type="password"
                          id="oldPassword"
                          placeholder="Enter current password"
                          class="input input-bordered input-secondary focus:input-secondary"
                          required
                        />
                      </div>

                      <div class="form-control">
                        <label class="label">
                          <span
                            class="label-text font-semibold flex items-center gap-2"
                          >
                            <i class="fas fa-shield-alt text-secondary"></i>
                            New Password
                          </span>
                        </label>
                        <input
                          type="password"
                          id="newPassword"
                          placeholder="Enter new password"
                          class="input input-bordered input-secondary focus:input-secondary"
                          required
                        />
                      </div>
                    </div>

                    <div class="card-actions justify-center mt-auto pt-8">
                      <button
                        type="submit"
                        class="btn btn-secondary btn-lg w-full"
                      >
                        <i class="fas fa-lock mr-2"></i>
                        Change Password
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Account Statistics Card -->
              <div
                class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300"
              >
                <div class="card-body">
                  <div class="flex items-center gap-3 mb-6">
                    <div
                      class="w-12 h-12 rounded-xl bg-gradient-to-br from-accent to-accent/80 flex items-center justify-center"
                    >
                      <i class="fas fa-chart-bar text-white text-lg"></i>
                    </div>
                    <h2 class="card-title text-xl">Account Statistics</h2>
                  </div>

                  <div class="space-y-6">
                    <div class="stat bg-base-200/50 rounded-xl p-4">
                      <div class="flex items-center justify-between">
                        <div>
                          <div class="stat-title text-sm opacity-70">
                            Member Since
                          </div>
                          <div
                            class="stat-value text-2xl text-primary"
                            id="memberSince"
                          >
                            2025
                          </div>
                          <div class="stat-desc text-xs">Account created</div>
                        </div>
                        <div class="stat-figure text-primary">
                          <i class="fas fa-user text-2xl"></i>
                        </div>
                      </div>
                    </div>

                    <div class="stat bg-base-200/50 rounded-xl p-4">
                      <div class="flex items-center justify-between">
                        <div>
                          <div class="stat-title text-sm opacity-70">
                            Reviews
                          </div>
                          <div
                            class="stat-value text-2xl text-secondary"
                            id="reviewCount"
                          >
                            0
                          </div>
                          <div class="stat-desc text-xs">Perfume reviews</div>
                        </div>
                        <div class="stat-figure text-secondary">
                          <i class="fas fa-comment text-2xl"></i>
                        </div>
                      </div>
                    </div>

                    <div class="stat bg-base-200/50 rounded-xl p-4">
                      <div class="flex items-center justify-between">
                        <div>
                          <div class="stat-title text-sm opacity-70">
                            Average Rating
                          </div>
                          <div
                            class="stat-value text-2xl text-accent"
                            id="avgRating"
                          >
                            -
                          </div>
                          <div class="stat-desc text-xs">Your reviews</div>
                        </div>
                        <div class="stat-figure text-accent">
                          <i class="fas fa-star text-2xl"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="mt-12">
              <div
                class="card bg-gradient-to-r from-primary/5 to-secondary/5 border border-primary/10"
              >
                <div class="card-body text-center">
                  <h3 class="card-title justify-center text-xl mb-4">
                    <i class="fas fa-bolt text-accent"></i>
                    Quick Actions
                  </h3>
                  <div class="flex flex-wrap justify-center gap-4">
                    <button class="btn btn-outline btn-primary">
                      <i class="fas fa-download mr-2"></i>
                      Export Data
                    </button>
                    <button class="btn btn-outline btn-secondary">
                      <i class="fas fa-cog mr-2"></i>
                      Settings
                    </button>
                    <button class="btn btn-outline btn-accent">
                      <i class="fas fa-question-circle mr-2"></i>
                      Help
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <%- include('partials/modals') %> <%- include('partials/toast') %>

    <!-- Edit Brand Modal -->
    <dialog id="editBrandModal" class="modal">
      <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">Edit Brand</h3>
        <form id="editBrandForm">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Brand Name</span>
            </label>
            <input
              type="text"
              id="editBrandName"
              name="brandName"
              class="input input-bordered"
              required
            />
          </div>
          <div class="modal-action">
            <button
              type="button"
              class="btn btn-ghost"
              onclick="closeEditBrandModal()"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-primary">Update Brand</button>
          </div>
        </form>
      </div>
      <form method="dialog" class="modal-backdrop">
        <button>close</button>
      </form>
    </dialog>

    <%- include('partials/footer') %>

    <script src="/javascripts/app.js"></script>

    <!-- Enhanced Modal Fix Script -->
    <script>
      // Smooth modal management with proper transitions
      function enhancedCloseModal() {
        return new Promise((resolve) => {
          // Remove body scroll lock immediately
          document.body.classList.remove("modal-open");
          document.body.style.overflow = "";
          document.body.style.paddingRight = "";

          // Find and close all open modals with transition
          const openModals = document.querySelectorAll(
            "dialog[open], .modal:target"
          );

          if (openModals.length === 0) {
            resolve();
            return;
          }

          openModals.forEach((modal, index) => {
            // Add closing animation
            modal.style.opacity = "0";
            const modalBox = modal.querySelector(".modal-box");
            if (modalBox) {
              modalBox.style.transform = "translateY(50px)";
            }

            // Close modal after animation
            setTimeout(() => {
              if (modal.close) {
                modal.close();
              }
              modal.removeAttribute("open");

              // Reset styles
              modal.style.opacity = "";
              if (modalBox) {
                modalBox.style.transform = "";
              }

              // Resolve on last modal
              if (index === openModals.length - 1) {
                resolve();
              }
            }, 300);
          });

          // Reset all forms
          setTimeout(() => {
            const forms = document.querySelectorAll("form");
            forms.forEach((form) => {
              if (form.id === "brandForm" || form.id === "perfumeForm") {
                form.reset();
                delete form.dataset.mode;
                delete form.dataset.perfumeId;
              }
            });

            // Reset modal titles
            const modalTitles = document.querySelectorAll(
              "#perfumeFormModal h3, #brandFormModal h3"
            );
            modalTitles.forEach((title) => {
              if (title.textContent.includes("Edit")) {
                if (title.closest("#perfumeFormModal")) {
                  title.textContent = "Add New Perfume";
                } else if (title.closest("#brandFormModal")) {
                  title.textContent = "Add New Brand";
                }
              }
            });
          }, 100);
        });
      }

      // Smooth modal opening
      function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          // Add body scroll lock
          document.body.classList.add("modal-open");

          // Show modal with animation
          modal.showModal();

          // Trigger reflow and animate
          requestAnimationFrame(() => {
            modal.style.opacity = "1";
            const modalBox = modal.querySelector(".modal-box");
            if (modalBox) {
              modalBox.style.transform = "translateY(0)";
            }
          });
        }
      }

      // Override the existing functions
      window.closeModal = enhancedCloseModal;
      window.openModal = openModal;

      // Add event listeners for modal close buttons
      document.addEventListener("DOMContentLoaded", function () {
        // Handle modal backdrop clicks
        document.addEventListener("click", function (e) {
          if (
            e.target.classList.contains("modal-backdrop") ||
            e.target.closest(".modal-backdrop")
          ) {
            enhancedCloseModal();
          }
        });

        // Handle escape key
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            enhancedCloseModal();
          }
        });

        // Prevent modal content clicks from closing modal
        document.addEventListener("click", function (e) {
          if (
            e.target.closest(".modal-content") ||
            e.target.closest(".modal-box")
          ) {
            e.stopPropagation();
          }
        });
      });

      // Smooth tab switching with proper transitions
      function showAdminTab(tabName) {
        return new Promise(async (resolve) => {
          // Close any open modals first
          await enhancedCloseModal();

          // Get all tabs and buttons
          const tabs = document.querySelectorAll(".admin-tab");
          const tabButtons = document.querySelectorAll(".tab");
          const selectedTab = document.getElementById(
            "admin" + tabName.charAt(0).toUpperCase() + tabName.slice(1)
          );
          const activeButton = document.querySelector(
            `[onclick="showAdminTab('${tabName}')"]`
          );

          // Update tab buttons immediately
          tabButtons.forEach((btn) => btn.classList.remove("active"));
          if (activeButton) {
            activeButton.classList.add("active");
          }

          // Hide current tabs with fade out
          tabs.forEach((tab) => {
            if (!tab.classList.contains("hidden")) {
              tab.style.opacity = "0";
              tab.style.transform = "translateY(20px)";
            }
          });

          // After fade out, hide tabs and show new one
          setTimeout(() => {
            tabs.forEach((tab) => {
              tab.classList.add("hidden");
              tab.style.opacity = "";
              tab.style.transform = "";
            });

            if (selectedTab) {
              selectedTab.classList.remove("hidden");
              // Trigger reflow for smooth animation
              selectedTab.offsetHeight;
            }

            resolve();
          }, 200);
        });
      }

      // Enhanced page initialization
      document.addEventListener("DOMContentLoaded", function () {
        // Optimize transitions
        document.body.style.transition = "padding-right 0.3s ease";

        // Handle modal backdrop clicks with debouncing
        let backdropClickTimeout;
        document.addEventListener("click", function (e) {
          clearTimeout(backdropClickTimeout);
          backdropClickTimeout = setTimeout(() => {
            if (
              e.target.classList.contains("modal-backdrop") ||
              (e.target.closest(".modal") && !e.target.closest(".modal-box"))
            ) {
              enhancedCloseModal();
            }
          }, 10);
        });

        // Handle escape key with debouncing
        let escapeKeyTimeout;
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            clearTimeout(escapeKeyTimeout);
            escapeKeyTimeout = setTimeout(() => {
              enhancedCloseModal();
            }, 10);
          }
        });

        // Prevent modal content clicks from closing modal
        document.addEventListener("click", function (e) {
          if (e.target.closest(".modal-box")) {
            e.stopPropagation();
          }
        });

        // Initialize first tab
        showAdminTab("members");
      });
    </script>
  </body>
</html>
